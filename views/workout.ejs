<%- include("partials/headerFooter/header.ejs") -%>
    

<h1 class="white-text"><%=workout.name%></h1>
<br>

<%#LOOP FOR OVER ALL EXERCISE%>
<%exercises.forEach(function(exercise, index){%>

<%#CHANGE UNIT FOR SELECT EXERCISES%>
<% let unit = "reps" %>  
<% if (exercise.name === "Plank Hold" | exercise.name === "Side Plank Hold" | exercise.name === "Hip Bridge Hold") {unit = "seconds"}%>

<!--Calculate edit state-->
<%let hoursDifference = null%>
<%if (lastExercises[index].lastId != null && lastExercises[index].lastId != undefined) { %>
    <%const lastCompletedDate = lastExercises[index].lastId.getTimestamp()%>
    <%const now = Date.now()%>
    <%hoursDifference = Math.abs(lastCompletedDate - now)/36e5%>
<%}%>

<%let editState = false%>
<%if (hoursDifference != (undefined || null) && hoursDifference < 18 && ((lastExercises[index].sets[1] != (undefined || null) && lastExercises[index].sets[1].weight != (undefined || null) ) || exercise.name === "Hip Bridge Hold")) {%>
    <% editState = true %>
<%}%>


    <!-- Handle if first time on exercise -->
    <%if (lastExercises[index].sets[0].reps === null && exercise.name != "Plank Hold" && exercise.name != "Side Plank Hold" && exercise.name != "Hip Bridge Hold" && exercise.name != "Pushups"){ %>

        <div class="card">
            <div class="card-body">
                <div id="E<%=index%>">
                    <!-- Exercise Header -->
                    <%- include("partials/workout/exerciseHeader/exerciseHeader.ejs", {index: index, exercise: exercise, unit: unit, editState: editState}) -%>
                    <%- include("partials/workout/firstTimeExercise.ejs", {index: index, exercise: exercise, unit: unit, user: user, functions: functions, editState: editState}) -%>
                </div>
            </div>
        </div>

    <%} else { %>


    

        <div class="card">
            <div class="card-body">
                <div id="E<%=index%>">
                    <!-- Exercise Header -->
                    <%- include("partials/workout/exerciseHeader/exerciseHeader.ejs", {index: index, exercise: exercise, unit: unit, editState: editState}) -%>

                    <div class="clickable" data-toggle="modal" data-target="#fullExerciseModal<%=index%>" data-backdrop="static" data-keyboard="false">
                        <h6>Sets</h6>
                        <%exercise.sets.forEach(function(set, index4){%>
                            <%const lastWeight3 = lastExercises[index].sets[index4].weight%>
                            <%const lastReps3 = lastExercises[index].sets[index4].reps%>
                            <%const lastNote = lastExercises[index].sets[index4].note%>
                            <%let weight%>
                            <%if (exercise.dropDown.length > 0){%>
                                <%weight = exercise.dropDown[displayExercises[index][index4].weight]%>
                            <%} else { %>
                                <% weight = "at " + displayExercises[index][index4].weight + " " + user.weightUnit%>
                            <%}%>

                            <p><button class="btn-list-number"><%=index4 + 1%></button>
                                <%if (editState) {%>
                                    <%=lastReps3%> <%=unit%> <%=weight%> <%if (lastNote.length > 0){%>
                                    , <%=lastNote%>
                                    <%}%>
                                <%} else if (displayExercises[index][index4].low === null) { %>
                                    <%=displayExercises[index][index4].high%> <%=unit%> <%=weight%> 
                                <% } else { %>
                                    <%=displayExercises[index][index4].low%> <%=unit%> <%=weight%> 
                                <% } %>
                            </p>
                        <%})%>

                        <!--If Completed in last 18 hours show Completed CheckMark-->
                        <%if (editState) {%>
                            <div style="text-align: center;">
                            <p class="diminished no-margin"><img src="/icons/checkMark.svg"> Completed - <a href="#" class="italic">Edit</a></p>
                            </div>
                        <%} else {%>
                            <button class="my-btn btn-full-width my-btn-secondary waves-effect waves-orange">Start Exercise</button>
                        <%}%>
                    </div>

                    <!--FullExercise Modal-->
                    <%- include("partials/workout/fullExercise.ejs", {index: index, exercise: exercise, unit: unit, user:user, functions: functions, editState: editState, hoursDifference: hoursDifference}) -%>
                </div>
            </div>
        </div>

<%}%>

<%})%>

</div>

<div id="barWeight" data-bar-weight="<%=user.barWeight%>"></div>

<%- include("partials/headerFooter/largeScreenOverlay.ejs") -%>

<%- include("partials/headerFooter/footerWorkout.ejs") -%>