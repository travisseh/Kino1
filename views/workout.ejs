<%- include("partials/header.ejs") -%>
    

<h1>Exercises</h1>

<br>

<%#LOOP FOR OVER ALL EXERCISE%>
<%exercises.forEach(function(exercise, index){%>
    <div id="E<%=index%>">
    <h3><%= exercise.name %> </h3>
    <br>
    <% if(exercise.weightType === "dumbbells") {%>
        <small class="text-muted">Enter per dumbbell weight, not total weight</small>
        <br>
        <br>
    <%}%>

    <%#WARMUPS LOOP%>

    <%#WEIGHT FROM FIRST SET FOR WARMUP CALC%>
    <%const firstDisplayWeight = displayExercises[index][0].weight%>

    <%exercise.warmUps.forEach(function(warmUp, ind){%>
        
        <%#HANDLE BODY-WEIGHT WARMUPS%>
        <% if (warmUp.percent === 0) { %>
            <p id="warmup_<%=index%>_<%=ind%>">Warm Up <%= ind + 1 %>: <strong><%= warmUp.reps %>  reps at bodyweight </strong></p>

        <%#HANDLE NO PREVIOUS EXERCISES%>    
        <%  } else if (typeof(firstDisplayWeight) === "string") { %>
            <p id="warmup_<%=index%>_<%=ind%>">Warm Up <%= ind + 1 %>: <strong><%= warmUp.reps %>  reps at <%=warmUp.percent%>% max weight </strong></p>
        <% } else { %>

            <%#DECLARE WEIGHT FOR EACH WARMUP%>
            <% const weight = functions.round(firstDisplayWeight * (warmUp.percent/100),5) %>

            <%#SHOW NORMAL WARMUP WEIGHT%>
            <p class="weightWarmUp" data-weight="<%=weight%>" id="warmup_<%=index%>_<%=ind%>"><%= warmUp.percent %> % Warm Up: <strong><%= warmUp.reps %>  reps at <%= weight%> lbs </strong> </p> 
            
            <%#WARMUP BARCALC%>
            <%if (exercise.weightType === "bar") { %>
                <small class="text-muted barCalcWarmUp" id="barCalc_<%=index%>_<%=ind%>"></small>
            <% } %>
        <%  } %>
    <%})%>

    <form action="/workout/<%=packageUrl%>/<%=workout.nameShort%>" method="POST">
    
    <%#SETS LOOP%>
    <%exercise.sets.forEach(function(set, i){%>
        <h6>Set <%=i + 1%></h6>

        <%#DECLARE WEIGHT FOR EACH SET%>
        <% const weight = displayExercises[index][i].weight %>
        <% let unit = "reps" %>  

        <%#CHANGE UNIT FOR SELECT EXERCISES%>
        <% if (exercise.name === "Plank Hold" | exercise.name === "Side Plank Hold" | exercise.name === "Hip Bridge Hold") {unit = "seconds"}%>

        <%#HANDLE BAR CALC IF BAR%>
            <%if (exercise.weightType === "bar") { %>
            <small class="text-muted barCalc" id="barCalc_<%=index%>_<%=i%>"></small>
            <%}%>

            <%#HANDLE LAST WEEKS SETS%>
            <%const lastWeight = lastExercises[index].sets[i].weight%>
            <%const lastReps = lastExercises[index].sets[i].reps%>
            <%const lastNote = lastExercises[index].sets[i].note%>
            <%const exerciseName = lastExercises[index]._id.name%>
            <%if (lastReps != null){ %>
                <br>Last time: <%=lastReps%> <%=unit%> at <%if (exercise.dropDown.length > 0){ %>
                <%=functions.optionMapper(exerciseName, lastWeight)%>
            <%} else {%>
                <%=lastWeight%>lbs<%}%><% if (lastNote) {%>, <%=lastNote%><%}%>
                </br>
            <%} %>

        <%#HANDLE REPS%>
             
            <div class="def-number-input number-input inline-block">
            <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepDown()" class="minus"></button>

            <input type="number" class=quantity required id="reps_<%=index%>_<%=i%>"
            <% if (displayExercises[index][i].low === null) { %>
                value="<%=displayExercises[index][i].high%>"
            <% } else { %>
                value="<%=displayExercises[index][i].low%>"
            <% } %>
            name="reps[]" min="0" max="999">
            <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
            </div> <%=unit%> 
            <br>

        <%#HANDLE WEIGHTS%>
            
            <%#HANDLE DROPDOWN OPTIONS%>
            <% if (exercise.dropDown.length > 0){ %>
                <select name="weight[]" required class="browser-default custom-select">
                <% exercise.dropDown.forEach(function(dropDownOption, inde){ %>
                    <option value="<%= inde %>" 
                    <% if (displayExercises[index][i].weight === inde ){ %>
                        selected
                    <% } %> >
                    <%=dropDownOption%></option>
                <% }) %>
                </select>
                
            <% } else { %>

            <%#HANDLE NORMAL WEIGHT INPUTS%>
                <div class="def-number-input number-input inline-block">
                <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepDown()" class="minus"></button>
                
                <input type="number" class="quantity" required id="weight_<%=index%>_<%=i%>"

                <%#NO PREVIOUS EXERCISES%>
                <%if (typeof(weight) === "string"){%>
                    placeholder="<%= weight %>" 

                <%#NORMAL EXERCISES%>
                    <%} else {%>
                    value="<%= weight %>"
                    <% } %>
                name="weight[]" step="<%=exercise.weightIncrement%>" min="<%=exercise.startWeight%>" max="999">
                
                <button type="button" onclick="this.parentNode.querySelector('input[type=number]').stepUp()" class="plus"></button>
                </div> lbs
                <br>
            <% } %>

        <%#HANDLE NOTES%>
        <input type="text" class="form-control startHidden" id="note_<%=index%>_<%=i%>" name="note[]" placeholder="note about your set" maxlength="140">
        <a href="#" class="addNote" id="addNote_<%=index%>_<%=i%>">Add note</a>
        <br>
        <br>

    <%})%>

    <input type="hidden" name="exerciseName" value="<%= exercise.name %>">
    <input type="hidden" name="templateId" value="<%= exercise._id %>">
    <input type="hidden" name="packageUrl" value="<%= packageUrl %>">
    <input type="hidden" name="workout" value="<%= workout.nameShort %>">
    <input type="hidden" name="order" value="<%= exercise.order %>">
    <button type="submit" class="btn btn-primary workout-button">Save</button>
    </form>

    </div>

<%})%>

</div>


<%- include("partials/footer.ejs") -%>